<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>O</title>
	<style>
		body { margin: 0; padding: 0; overflow:hidden;}
		canvas { width: 100%; height: 100%; }
		span { position: fixed; bottom: 0; right: 0; padding: 5px;  background: rgba(0,0,0,.7); color: #BBB;}
		a {color: #FFF; text-decoration: none; }
	</style>
</head>
<body>
<script src="js/three.min.js"></script>
<script src="util.js"></script>
<script src="mouse.js"></script>
<script src="ospace.js"></script>
<script src="obits.js"></script>
<script src="sound.js"></script>
<script>



	
var r45d=3.14/4;
var r90d=3.14/2;
var r180d=3.14;


//create levels
var levelFactory={
 menu: function() {       
       addLevelIndicator('t0',0,-20,10,0,0,-r90d);
	   addLevelIndicator('t1',1,-15,8.5,15,0,-r45d);
	   addLevelIndicator('t2',2,0,7,20);
	   addLevelIndicator('t3',3,15,5.5,15,0,r45d);
	   addLevelIndicator('t4',4,20,4,0,0,r90d);
	   addLevelIndicator('t5',5,15,2.5,-15,0,r90d+r45d);
	   addLevelIndicator('t6',6,0,1,-20,0,r180d);
	   addLevelIndicator('t7',7,-15,-.5,-15,0,r180d+r45d);
	   addLevelIndicator('t8',8,-20,-2,0,0,-r90d);
	   addLevelIndicator('t9',9,-15,-3.5,15,0,-r45d);
	   addLevelIndicator('t10',10,0,-4,20);
	   addLevelIndicator('t11',11,15,-5.5,15,0,r45d);
	   addLevelIndicator('t12',12,20,-7,0,0,r90d);
	   addLevelIndicator('t13',13,15,-8.5,-15,0,r90d+r45d);
	   addLevelIndicator('t14',14,0,-10,-20,0,r180d);
	   addLevelIndicator('t15',15,-15,-11.5,-15,0,r180d+r45d);
	   addBox('b1',0,0,0);
	   //Animate scene to correct twist
	   var target=localStorage.getItem('levelNext');
	   callEachFrame(3500,function(r) {	   
	      puzzle.scene.rotation.x=inter(r,0,.4-r90d/32*target,siso);
          puzzle.scene.rotation.y=inter(r,r180d,r90d-r90d/2*(target%8),siso);
	   });

	    },
 0: function() {
       addTorus('t1',1,0,0,0)
	      .obit.failsOn(0,'n1',0,.1);
       addNail('n1',0,0,0,r90d);	  	
	    },
 1: function() {
       addTorus('t1',2,0,0,0)
	      .obit.failsOn(0,'b1',0,.15).failsOn(0,'b2',0,.15);
       addBoard('b1',0,-2,-4,r180d,r90d,0);
	   addBoard('b2',0,-2,+4,0,r90d,0);
	   
      }	 ,
 2: function() {
       addTorus('t1',3,0,0,0)
	      .obit.failsOn(0,'n1',0,.05);
       addNail('n1',0,0,0,r90d)
	      .obit.failsOn(0,'b1',0,.05)
		  .failsOn(0,'b2',0,.15)
		  .failsOn(0,'b3',0,.25)
		  .failsOn(1,'b1',0,.1)	  	
		  .failsOn(1,'b2',0,.1);		  
	   addBoard('b1',0,-2,-12,r180d,r90d,0);
	   addBoard('b2',0,-2,-16,0,r90d,0);
	   addBoard('b3',0,-2,-20,-r90d,0,r90d).obit
	      .failsOn(1,'n1',1,.8);
	   
      }	 ,
 3: function() {
       addTorus('t1',4,0,0,0)
	      .obit.failsOn(0,'n1',0,.05);
       addNail('n1',0,0,0,r90d)
	      .obit.failsOn(0,'b1',0,.1)
		  .failsOn(1,'b1',0,.1);	  	
	   addBoard('b1',0,-2,-15,r180d,r90d,0).obit
	      .failsOn(0,'n2',0,.03)
		  .failsOn(1,'n2',0,.3);
	   addNail('n2',0,10,-3,-r90d).obit
	      .failsOn(0,'b2',0,.28);
	   addBoard('b2',0,4,17,0,r90d,0).obit
	      .failsOn(1,'n2',1,.9);
		
      }	  ,
 4:function () {
	    addTorus('t1',5,0,0,0,r90d).obit
		   .failsOn(0,'nt',0,.1);
		addNail('nt',0,0,0).obit
		   .failsOn(0,'n1b',0,.1)
		   .failsOn(1,'n1b',0,.1)
		   .failsOn(0,'n2b',0,.1)
		   .failsOn(1,'n2b',0,.1)
		   .failsOn(0,'n3b',0,.1)
		   .failsOn(1,'n3b',0,.1)
		   .failsOn(0,'n4b',0,.1)
		   .failsOn(1,'n5b',0,.1);
		   
	    addNail('n1b',0,-7,9.5,r180d+r90d/2).obit
		   .failsOn(0,'n1t',0,.05)
		   .failsOn(1,'n1t',0,.05);
		addNail('n1t',0,10,9.5,r180d-r90d/2).obit; 
		
        addNail('n2b',0,-7,-9.5,r180d-r90d/2).obit
		   .failsOn(0,'n2t',0,.05)
		   .failsOn(1,'n2t',0,.05);
		addNail('n2t',0,10,-9.5,r180d+r90d/2).obit; 
		
        addNail('n3b',-9.5,-7,0,0,0,r180d+r90d/2).obit
		   .failsOn(0,'n3t',0,.05)
		   .failsOn(1,'n3t',0,.05);
		addNail('n3t',-9.5,10,0,0,0,r180d-r90d/2).obit; 
		
        addNail('n4b',9.5,-7,0,0,0,r180d-r90d/2).obit
		   .failsOn(0,'n4t',0,.05)
		   .failsOn(1,'n4t',0,.05);
		addNail('n4t',9.5,10,0,0,0,r180d+r90d/2).obit; 
		
        		
	   },

 5: function() {
       addTorus('t1',6,0,0,0)
	      .obit.failsOn(0,'n1',0,.05);
       addNail('n1',0,0,0,r90d).obit
	      .failsOn(0,'s1',0,0.025)	   
		  .failsOn(1,'s1',0,0.025);
       addSpanner('s1',0,-5,-15).obit
	      .failsOn(0,'n2',0,0.2);	  		   
	   addNail('n2',0,-10,-10,-r90d).obit
	      .failsOn(1,'s1',1,.65);	          
      },
 6: function() {
       addTorus('t1',7,0,0,0)
	      .obit.failsOn(0,'n1',0,.05);
       addNail('n1',0,0,8,r90d).obit
	      .failsOn(0,'s1',0,0.025)	   
		  .failsOn(0,'s2',0,0.3);		  
       addSpanner('s1',0,-5,-8).obit
	      .failsOn(0,'n2',0,0.2)
		  .failsOn(1,'n1',1,0.2);	  		   
	   addNail('n2',0,-10,-10,-r90d).obit
	      .failsOn(1,'s1',1,.35);	          
       addSpanner('s2',5,0,-15,0,0,3.14/2,0).obit
	      .failsOn(0,'n3',0,0.2)
		  .failsOn(1,'n1',1,0.2);	
	   addNail('n3',10,0,-8,r90d).obit
	      .failsOn(1,'s2',1,.35);	          
      },
 7: function() {
	   addTorus('t1',8,0,0,0)
	      .obit.failsOn(0,'b1',0,.15).failsOn(0,'b2',0,.15);
       addBoard('b1',0,0,-4,r180d,r90d,0).obit
	      .failsOn(0,'b3',0,0.05)
		  .failsOn(1,'b3',0,0.2);
	   addBoard('b2',0,0,+4,0,r90d,0).obit
	      .failsOn(0,'b4',0,0.05)
		  .failsOn(1,'b4',0,0.2);;
	   addBoard('b3',0,11,0,0,0,-r90d).obit
	     .failsOn(0,'b5',0,0.05)
		 .failsOn(1,'b5',0,0.1);
	   addBoard('b4',0,-11,0,0,0,r90d).obit
	     .failsOn(0,'b6',0,0.05)
		 .failsOn(1,'b6',0,0.1);
	   addBoard('b5',-11,3,0,r90d,0,0);
	   addBoard('b6',11,-3,0,r90d,0,0);	   
	
	},
	
   8: function () {
	   addTorus('t1',9,0,8,0,r90d)
	      .obit.failsOn(0,'n1',0,.05);
       addNail('nt',0,12,0).obit
	      .failsOn(0,'s1',0,.05)
		  .failsOn(0,'s2',0,.25)
		  .failsOn(0,'s3',0,.45)
		  .failsOn(0,'s4',0,.65)
		  .failsOn(1,'s1',0,.05);
		  
	   addSpanner('s1',0,-3,-5,r90d).obit
	           .failsOn(0,'n1',0,.2);
	   addNail('n1',0,-8,-10).obit
	      .failsOn(0,'n5',0,.1)
		  .failsOn(1,'n5',0,.1)
		  .failsOn(1,'s1',1,.5);
	   addSpanner('s2',0,-10,5,-r90d).obit
	      .failsOn(0,'n2',0,.2)
		  .failsOn(1,'nt',1,.2);
	   addNail('n2',0,-8,10).obit
	      .failsOn(0,'n5',0,.1)
		  .failsOn(1,'n5',0,.1)
		  .failsOn(1,'s2',1,.5);
	   addSpanner('s3',-5,-17,0,0,0,r90d).obit
	      .failsOn(0,'n3',0,.2)
		  .failsOn(1,'nt',1,.2);
	   addNail('n3',-10,-18,0,r180d).obit
	      .failsOn(0,'n6',0,.1)
		  .failsOn(1,'n6',0,.1)
		  .failsOn(1,'s3',1,.4);
	   addSpanner('s4',5,-23,0,0,0,-r90d).obit
	      .failsOn(0,'n4',0,.2)
		  .failsOn(1,'nt',1,.2);
	   addNail('n4',10,-18,0,r180d).obit
	      .failsOn(0,'n6',0,.1)
		  .failsOn(1,'n6',0,.1)
		  .failsOn(1,'s4',1,.5);
	   addNail('n5',0,-23,0,r90d).obit
	      .failsOn(0,'s4',1,.3);
	   addNail('n6',0,-3,0,0,0,r90d).obit
	      .failsOn(1,'s1',1,.3);
	   
	},
	9: function() {
       addTorus('t1',10,0,5,0,r90d)
	      .obit.failsOn(0,'n1',0,.05);
       addNail('n1',0,8,0).obit
	      .failsOn(0,'b1',0,0.025)	   		  	  
		  .failsOn(1,'b1',0,0.3);		  
       addBoard('b1',0,-5,0,0,3.14/2,3.14/2).obit
	      .failsOn(0,'n2',0,.05)
		  .failsOn(0,'n3',0,.05);
	   addNail('n2',6.5,0,-12).obit
	        .failsOn(0,'b3',0,.1)
			.failsOn(0,'b2',1,.1)
	        .failsOn(1,'b3',0,.1)
			.failsOn(1,'b2',1,.1);
	   addNail('n3',-6.5,0,-12).obit
	      .failsOn(0,'b2',0,.1)
		  .failsOn(1,'b2',0,.1);
	   addBoard('b2',-16,-14,-10,0,0,3.14/2).obit
	      .failsOn(0,'b3',0,.1);
	   addBoard('b3',6,-14,-10,0,0,3.14/2).obit
	      .failsOn(1,'b2',1,.1);
	   
      },
	
	10: function () {
	   addTorus('t1',11,0,0,0).obit
	     .failsOn(0,'nc',0,0.1)
		 .failsOn(0,'nt1',0,0.1)
		 .failsOn(0,'nt2',0,0.1)
		 .failsOn(0,'nb1',0,0.1)
		 .failsOn(0,'nb2',0,0.1);
	   addNail('nc',0,0,0,r90d).obit
	     .failsOn(0,'b1',0,0.2)
		 .failsOn(1,'b1',0,0.05);
	   addNail('nt1',0,3.5,3.5,0,0,r90d).obit
	     .failsOn(0,'s1',1,.05)
		 .failsOn(1,'s1',1,.05);
	   addNail('nt2',0,3.5,-3.5,0,0,-r90d).obit
	     .failsOn(0,'s2',1,.05)
		 .failsOn(1,'s2',1,.05);
	   addNail('nb1',0,-3.5,3.5,0,0,-r90d).obit
	     .failsOn(0,'s2',0,.05)
		 .failsOn(1,'s2',0,.05);;	   
	   addNail('nb2',0,-3.5,-3.5,0,0,r90d).obit
	     .failsOn(0,'s1',0,.05)
		 .failsOn(1,'s1',0,.05);
	   addSpanner('s1',15,0,0,r90d/2,0,0).obit;
	   addSpanner('s2',-15,0,0,-r90d/2,0,0).obit
	     .failsOn(0,'nl1',0,.2);;
	   addNail('nl1',-15,-7,0,r90d/2).obit
	     .failsOn(1,'s2',0,.8)
		 .failsOn(1,'s3',0,.4);	
	   addNail('nl2',-15,-16,-23,-r180d+r90d/2).obit
	     .failsOn(0,'s2',0,.4)
		 .failsOn(0,'s3',0,.05);
	   	   
	   addSpanner('s3',-15,-8,-8,-r90d/2,0,0).obit
	     .failsOn(0,'nl1',0,.2);
	   
	   addBoard('b1',0,-2,-17,r90d,0,-r90d).obit
	     .failsOn(0,'nl2',0,.1)
		 .failsOn(1,'nl2',0,.1);
		 
	},
	11: function () {
	   addTorus('t1',12,0,8,0,r90d)
	      .obit.failsOn(0,'nt',0,.05);
       addNail('nt',0,16,0).obit
	      .failsOn(0,'s1',0,.1)
		  .failsOn(0,'s2',0,.2);  
	   addSpanner('s1',0,0,-5,r90d).obit
	      .failsOn(0,'n1',0,.2)
		  .failsOn(1,'nt',1,.2);
	   addNail('n1',0,0,-10,r180d).obit
	      .failsOn(0,'n3',0,.05)
		  .failsOn(1,'n3',0,.05);  
	   addSpanner('s2',4.33,-7,-2.5,r90d,0,r180d/3).obit
	      .failsOn(0,'n2',0,.2)
		  .failsOn(1,'nt',1,.2);
	   addNail('n2',8.66,-7,-5,r180d).obit
	     .failsOn(0,'s3',0,.1)
	     .failsOn(0,'n3',1,.25);
	   addSpanner('s3',4.33,9,-7.5,r90d,0,-r180d/3).obit
	     .failsOn(0,'n1',0,.2);
	   addNail('n3',-8.66,14,-15,r90d,0,r180d*2/3).obit
	     .failsOn(0,'n2',1,.2);  
	   
    },
	
	12: function() {
	   addTorus('t1',13,0,13,0,r90d).obit
	      .failsOn(0,'nx1',0,.1)
		  .failsOn(0,'ny1',0,.1);
	   addBoard('b1',-25,5,0,0,0,r90d).obit
	      .failsOn(0,'b2',1,.1)
		  .failsOn(0,'b3',1,.1)
		  .failsOn(0,'b4',1,.1);
	   addBoard('b2',25,5,0,0,0,-r90d).obit
	      .failsOn(0,'b1',1,.1)
		  .failsOn(0,'b3',1,.1)
		  .failsOn(0,'b4',1,.1);
	   addBoard('b3',0,5,25,0,r90d,r90d).obit	   
	      .failsOn(0,'b2',1,.1)
		  .failsOn(0,'b1',1,.1)
		  .failsOn(0,'b4',1,.1);
	   addBoard('b4',0,5,-25,0,r90d,-r90d).obit
	      .failsOn(0,'b2',1,.1)
		  .failsOn(0,'b3',1,.1)
		  .failsOn(0,'b1',1,.1);
	   
	   addNail('nx1',0,10,0,0,0,-r90d).obit
	      .failsOn(0,'nv1',0,.4);
	   addNail('nv1',-25,20,0,0).obit
	      .failsOn(1,'nx1',1,.2)
		  .failsOn(0,'b1',0,.1)
		  .failsOn(1,'b1',0,.1)
		  .failsOn(0,'nx2',0,.4);
	   addNail('nx2',-15,-5,0,0,0,r90d).obit
	      .failsOn(1,'nv1',1,.8)
		  .failsOn(0,'nv2',0,.8);
	   addNail('nv2',25,-10,0,r180d).obit
	      .failsOn(1,'nx2',1,.4)
		  .failsOn(0,'b2',0,.1)
		  .failsOn(1,'b2',0,.1);
	   
	   addNail('ny1',0,16,0,r90d,0,0).obit
	      .failsOn(0,'nv3',0,.4);
	   addNail('nv3',0,20,-25,0).obit
	      .failsOn(1,'ny1',1,.4)
		  .failsOn(0,'b4',0,.1)
		  .failsOn(1,'b4',0,.1)
		  .failsOn(0,'ny2',0,.2);
	   
	   addNail('ny2',0,0,-20,-r90d,0,0).obit
	      .failsOn(1,'nv3',1,.8)
		  .failsOn(0,'nv4',0,.8);
	   
	   addNail('nv4',0,-10,20,r180d).obit
	      .failsOn(1,'ny2',1,.4)
		  .failsOn(0,'b3',0,.1)
		  .failsOn(1,'b3',0,.1);
	   
	   
	},
 
	13: function () {
	   addTorus('t1',14,0,15,0).obit
	      .failsOn(0,'s1',0,.2)
		  .failsOn(0,'s2',0,.2);
	   addSpanner('s1',0,10,6).obit
	      .failsOn(0,'n1',0,.2)
		  .failsOn(0,'n3',0,.2)
		  .failsOn(0,'n7',1,.2);
	   addNail('n1',0,15,6,0,0,-r90d).obit
	      .failsOn(1,'s1',1,.5)
		  .failsOn(0,'b2',0,.15)
		  .failsOn(1,'b2',0,.05);
	   addSpanner('s2',0,10,-6).obit
	      .failsOn(0,'n2',0,.2)
		  .failsOn(0,'n3',0,.2);
		  
	   addNail('n2',0,15,-6,0,0,r90d).obit
	      .failsOn(1,'s2',1,.5)
		  .failsOn(0,'b1',0,.1)
		  .failsOn(1,'b1',0,.05);
	   addSpanner('s3',0,0,0,0,r90d,0).obit
	      .failsOn(0,'n3',0,.2)
		  .failsOn(0,'n4',0,.2)
		  .failsOn(0,'n7',1,.2);
	   addNail('n3',0,5,0,-r90d,0,0).obit
	      .failsOn(1,'s1',1,.3)
		  .failsOn(1,'s2',1,.7)
		  .failsOn(1,'s3',1,.5)
		  .failsOn(1,'n7',1,.5);
       addNail('n4',-5,-5,0,0,0,r90d).obit
	      .failsOn(1,'s3',1,.35)
		  .failsOn(0,'b3',0,.2)
		  .failsOn(0,'b1',1,.2)
		  .failsOn(1,'b2',1,.95);
	   addBoard('b1',15,17,0,0,0,0).obit
	      .failsOn(0,'b3',0,.1)
		  .failsOn(0,'n4',1,.35);
	   addBoard('b2',-17,17,0,0,0,0).obit
	      .failsOn(0,'n7',0,.05)
		  .failsOn(1,'n7',0,.4)
		  .failsOn(0,'n4',0,.4);
	   addBoard('b3',15,-2,0,0,0,0).obit
	      .failsOn(1,'b1',1,.1)
		  .failsOn(1,'n4',1,.65);
	   addNail('n5',0,-5,15,r90d,0,0).obit
	      .failsOn(0,'s3',0,.05)
		  .failsOn(1,'s3',0,.05)
		  .failsOn(1,'s4',1,.2)
		  .failsOn(1,'n7',1,.5);
       addSpanner('s4',2.5,-0.5,12,0,0,-r90d/3).obit
	      .failsOn(0,'n5',0,.2);
	   addNail('n6',5,4,-3,-r90d,0,0).obit
	      .failsOn(0,'s4',0,.05)
		  .failsOn(1,'s4',0,0.05);
       addNail('n7',-28,5,3,0,0,r90d).obit
	      .failsOn(0,'n3',0,.5)
		  .failsOn(0,'n5',0,.7)
		  .failsOn(0,'s3',1,.6)
		  .failsOn(0,'s1',1,.6);		 	          
	},
	test: function() {
	   addTorus('t1',14,0,15,0).obit;
	   addLock('l1',0,0,0).obit;	   
	}
}


jukeBox.loadUp(['audio/t1.mp3','audio/t2.mp3','audio/t3.mp3','audio/t4.mp3']);
soundFX.add('fail','audio/fail.wav');
soundFX.add('slide','audio/slide.wav');
soundFX.add('nslide','audio/nslide.wav');
soundFX.add('ticks','audio/ticks.wav');
soundFX.add('win','audio/win.wav');

createOSpace();
openLevel(levelFactory.test);
	
</script>
<span>by <a href='http://www.elementalsystems.co.za' target="_blank">elementalsystems</a> for <a href='http://twelvegamesayear.blogspot.co.za/' target="_blank">twelevegamesayear</a></span>
</body>
</html>

